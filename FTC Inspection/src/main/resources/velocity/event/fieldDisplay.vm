##
## Copyright (c) 2016-2018 Thomas Barnette and Trey Woodlief
## All Rights Reserved.
##

<!-- Copyright (c) 2016-2018 Thomas Barnette and Trey Woodlief -->
<!-- All Rights Reserved.                                      -->

#if($ad2)
  			#set($cbSize = 100)
  			#set($jSize = 42)
  			#set($bSize = 35)
  			#set($pSize = 40)
  		#else
  			#set($cbSize = 50)
  			#set($jSize = 25)
  			#set($pSize = 20)
  			#set($bSize = 18)
  		#end

#macro (grid $alliance $size $index)
	<div id="grid${alliance}" class="grid">
		#if($ad2)
			#set($top1 = 15)
  			#set($top2 = 94)
  			#set($top3 = 172)
  			#set($top4 = 250)
  			#set($left1 = 7)
  			#set($left2 = 90)
  			#set($left3 = 165)
  		#else
  			#set($top1 = 8)
  			#set($top2 = 46)
  			#set($top3 = 86)
  			#set($top4 = 124)
  			#set($left1 = 5)
  			#set($left2 = 45)
  			#set($left3 = 85)
  		#end
  		<img id="background${alliance}${index}" class="gridBackground" src="/img/empty-grid-${alliance}${size}.png"alt="Cryptobox1"> 		
  		<img id="gridOverlay${alliance}${index}" class="gridOverlay" src="/img/grid_blank${size}.png" alt="grid">
  		<img id="gridCipher_${alliance}_${index}" src="/img/froggy-grid-blue${size}.png" visible="false" class="gridCipher" alt="cipher">	
  		<img id="${alliance}_${index}_0_0" visible="false" class="cell" src="/img/grey-square${size}.png" alt="brown" 
  		style="position:absolute;left:$left1; top:$top1;">
  		<img id="${alliance}_${index}_0_1" visible="false" class="cell" src="/img/brown-square${size}.png" alt="brown" 
  		style="position:absolute;left:$left2; top:$top1;">
  		<img id="${alliance}_${index}_0_2" visible="false" class="cell" src="/img/grey-square${size}.png" alt="brown" 
  		style="position:absolute;left:$left3; top:$top1;">
  		<img id="${alliance}_${index}_1_0" visible="false" class="cell" src="/img/grey-square${size}.png" alt="brown" 
  		style="position:absolute;left:$left1; top:$top2;">
  		<img id="${alliance}_${index}_1_1" visible="false" class="cell" src="/img/brown-square${size}.png" alt="brown" 
  		style="position:absolute;left:$left2; top:$top2;">
  		<img id="${alliance}_${index}_1_2" visible="false" class="cell" src="/img/grey-square${size}.png" alt="brown" 
  		style="position:absolute;left:$left3; top:$top2;">
  		<img id="${alliance}_${index}_2_0" visible="false" class="cell" src="/img/grey-square${size}.png" alt="brown" 
  		style="position:absolute;left:$left1; top:$top3;">
  		<img id="${alliance}_${index}_2_1" visible="false" class="cell" src="/img/brown-square${size}.png" alt="brown" 
  		style="position:absolute;left:$left2; top:$top3;">
  		<img id="${alliance}_${index}_2_2" visible="false" class="cell" src="/img/grey-square${size}.png" alt="brown" 
  		style="position:absolute;left:$left3; top:$top3;">
  		<img id="${alliance}_${index}_3_0" visible="false" class="cell" src="/img/grey-square${size}.png" alt="brown" 
  		style="position:absolute;left:$left1; top:$top4;">
  		<img id="${alliance}_${index}_3_1" visible="false" class="cell" src="/img/brown-square${size}.png" alt="brown" 
  		style="position:absolute;left:$left2; top:$top4;">
  		<img id="${alliance}_${index}_3_2" visible="false" class="cell" src="/img/grey-square${size}.png" alt="brown" 
  		style="position:absolute;left:$left3; top:$top4;">
  		#if($ad2)
  		<img id="${alliance}_${index}_chevron_r0" visible="false" class="chevron chevronR" src= #if($index==1)"/img/chevron_white.png"#else "/img/chevron_flip_white.png" flip="true"#end alt="chevron"
  		style="top:30;">
  		<img id="${alliance}_${index}_chevron_r1" visible="false" class="chevron chevronR" src= #if($index==1)"/img/chevron_white.png"#else "/img/chevron_flip_white.png" flip="true"#end alt="chevron"
  		style="top:110;">
  		<img id="${alliance}_${index}_chevron_r2" visible="false" class="chevron chevronR" src = #if($index==1)"/img/chevron_white.png"#else "/img/chevron_flip_white.png" flip="true"#end alt="chevron"
  		style="top:188;z-index:2;">
  		<img id="${alliance}_${index}_chevron_r3" visible="false" class="chevron chevronR" src = #if($index==1)"/img/chevron_white.png"#else "/img/chevron_flip_white.png" flip="true"#end alt="chevron"
  		style="top:265;">
  		
  		<img id="${alliance}_${index}_chevron_c0" visible="false" class="chevron chevronC" src = "/img/chevron_down_white.png" alt="chevron"
  		style="left:26;">
  		<img id="${alliance}_${index}_chevron_c1" visible="false" class="chevron chevronC" src = "/img/chevron_down_white.png" alt="chevron"
  		style="left:105;">
  		<img id="${alliance}_${index}_chevron_c2" visible="false" class="chevron chevronC" src = "/img/chevron_down_white.png" alt="chevron"
  		style="left:182;">
  		
  		#end
  	</div>
#end
#macro (parking $alliance $size)
	<div id="parking$alliance" class="parking" visible="true">
  			#if($ad2)<div style="float:left; width:200;">#end
  			<img id="parking${alliance}1" src="/img/parking_black${size}.png" alt="Parking">
  			#if($ad2)
  			</div>
  			<div style=" float:left;position:relative;width:480px;"></div>
  			#else
  			<br>
  			#end
  			<img id="parking${alliance}2" src="/img/parking_black${size}.png" alt="Parking">
  		</div>
#end
#macro (ball $alliance $size)
	<div id="ball$alliance" class="ball" visible="true">
			#if($ad2)<div style="float:left;width:420;">#end
  			<img id="jewel${alliance}1" src="/img/ball-split${size}.png" alt="Balance Stone" >
  			#if($ad2)
  			</div>
  			<div style="float:left; position:relative; width:480px;heigh:100px;"></div>
  			#else
  			<br>
  			#end
  			
  			<img id="jewel${alliance}2" src="/img/ball-split${size}.png" alt="Balance Stone" >
  			
  		</div>
#end
#macro (balance $alliance $size)
	<div id="balance$alliance" class="balance" visible=#if($overlay)"false"#else"true"#end>
	<br>
  			<img id="balance${alliance}1" src="/img/tt_black${size}.png" alt="Balance Stone">
  			#if($ad2)
  			#else
  			
  			<br>
  			<br>
  			<br>
  			#end
  			<img id="balance${alliance}2" src="/img/tt_black${size}.png" alt="Balance Stone">
  		</div>
 #end
 
 #macro (previewBar $a $i)
 <div style="position:relative;background-color:#D6C281">
 <img id="${a}Bar${i}" src="/img/alliance${a}190.png" alt="${a}${i}">
 	<div class="preview previewText previewNumber" id="${a}${i}_number"></div>
 	<div class="preview previewText previewName" id="${a}${i}_name"></div>
 	<div class="preview previewText previewRank" id="${a}${i}_rank"></div>
 </div>
 #end
 
 #macro (resultBar $a $i)
 	<div class="resultBar resultBar$i">
 		<div  class="result resultText resultSeed"><span class="resultSeedText" id="${a}${i}Seed">4</span></div>
 		<img id="${a}Bar${i}" src="/img/alliance${a}92.png" class="resultBarImg" alt="${a}${i}">
 		<div class="result resultText resultNumber" id=${a}${i}_resultNumber>
 			#if($i == "head")Team#end
 		</div>
 		<img src="" id="${a}${i}_card" alt="card"  class="result resultText resultCard" visible="false"> 		
 		<div class="result resultText resultName" id=${a}${i}_resultName></div>
 		<div class="result resultText resultRank" id=${a}${i}_resultRank>
 			#if($i == "head")Rank#end
 		</div>
 	</div>
 #end
 
 #macro (selectionBar $a)
 	<div class="selectionBar" id="selectionBar_$a">
 		<img src="/img/alliancebar92.png" id="selectionBarImg$a" class="selectionBarImg" alt="Alliance Bar">
 		<div class="selectionSeed" ><span class="selectionSeedText">$a</span></div>
 		<div class="selectionTeam selectionTeam1"><span class="selectionText" id="selection_${a}_1"></span></div>
 		<div class="selectionTeam selectionTeam2"><span class="selectionText" id="selection_${a}_2"></span></div>
 		<div class="selectionTeam selectionTeam3"><span class="selectionText" id="selection_${a}_3"></span></div>
 	</div>
 
 #end
 
 #macro (resultField $lab $id)
 	<div style="position:relative; height:80;">
		<div class="blueField"><span class="resultScoreText" id="blueField_${id}">0</span></div>
		<div class="midField"><span class="resultMidText">$lab</span></div>
		<div class="redField"><span class="resultScoreText" id="redField_${id}">0</span></div>
 	</div>
 #end
 
 
<html>
	<style>
	@font-face {
		font-family: "Arial Black";
		src: url("/fonts/Arial Black.ttf");
	}
	#top{
		position:absolute;
		top:30px;
		left:400;
		width:1120;
		font:60px  "Arial Black", Arial, Helvetica, sans-serif;
		text-align:center;
	}
	#timer{
		position: absolute;
		top: 225px;
		left:600px;
		width:765px;
		background-color:black;
	}
	#timer[ad2="true"][timeout="false"]{
		position: absolute;
		#if($flip)
		top:250px;
		#else
		top: 851px;
		#end
		left:800px;
		width:320px;
		z-index:2;
		background-color:black;
	}
	
	.timerImage{
		max-width:33%;
		max-height:100%;
	}
	
	div[timeout="true"] > #progressBar{
		display:none;
	}
	
	#progressBar[visible="false"]{
		display:none;
	}
	
	#progressBar{
		position:absolute;
		text-align:left;
		width:840px;
		height:70px;
		background-color:#b3b3b3;
		top:-70;
		left:-260;
		float:left;
		-webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */
		-moz-box-sizing: border-box; /* Firefox, other Gecko */
		box-sizing: border-box; /* Opera/IE 8+ */
		border:2px solid black;
	}
	#progress{
		height:100%;
		background-color:green;
		border-radius: 0px 15px 15px 0px;
		align:left;
	}
	#progressBar[overlay="true"]{
		width:520px;
		left:700px;
		top:899;
		height:51;
	}
	#progressTime{
		position:absolute;
		width:100px;
		height:30px;
		top:-11;
		left:210;
		text-align:center;
		font:45px "Arial Black", Arial, Helvetica, sans-serif;
		color:black;
		z-index:3;
			
	}
	#progressHighlight{
		position:absolute;
		width:100px;
		height:38px;
		top:4;
		left:210;
		filter: alpha(opacity=40); /* internet explorer */
 	    -khtml-opacity: 0.4;      /* khtml, old safari */
  		-moz-opacity: 0.4;       /* mozilla, netscape */
  		opacity: 0.4;           /* fx, safari, opera */		
		border-radius: 12px 12px 12px 12px;
		
		background-color:white;	
		z-index:2;
	}
	
	
	div[overlay="true"] > #progress{
	
	}
	
	div[ad2="true"][timeout="false"] > .timerImage{
		height:180;
	}
	
	#timer[visible="false"]{
		display:none;
	}
	#random{
		position: absolute;
		#if($flip)
		top:430px;
		#else
		top: 180px;
		#end
		left:762px;
		background-color:white;
	}
	#random[visible="false"]{
	display:none;
	}
	#preview{
		position:absolute;
		top:180px;
		left:160px;
	}
	#if($flip)
		#preview[elims="false"]{
			top:430px;
		}
	#end
	
	#preview[visible="false"]{
	display:none;
	}
	
	.preview{
		z-index:3;
	}
	.previewText{
		font:45px "Arial Black", Arial, Helvetica, sans-serif;
		color:white;
		top:12;
	}
	.previewNumber{
		position:absolute;
		left:70;
		width:250px;
	}
	.previewName{
		position:absolute;
		left:270;
		width:1100px;
	}
	.previewRank{
		position:absolute;
		left:1470;
		width:50px;
		text-align:center
	}
	#result{
		position:absolute;
		top:180px;
		left:160px;
	}
	#result[visible="false"]{
		display:none;
	}
	
	.resultBars{
		position:relative;
		width:800;
		float:left;
	}
	.resultFields{
		position:relative;
		width:1600;
		float:left;
	}
	.resultText{
		font:45px "Arial Black", Arial, Helvetica, sans-serif;
		top:12;
		color: white;
	}
	.resultMidText{
		font:45px "Arial Black", Arial, Helvetica, sans-serif;
		top:10;
	}
	.resultScoreText{
		position:relative;
		font:75px "Arial Black", Arial, Helvetica, sans-serif;
		top:-15;
		color:white;
	}
	.resultNumber{
		position:absolute;
		width:250px;
	}
	div[elims="true"][ad2="false"] > div > div > .resultNumber{
		position:absolute;
		left:70;
		width:250px;
	}
	div[elims="true"][ad2="true"] > div > div > .resultNumber{
		position:absolute;
		left:50;
		width:230px;
	}
	
	.resultCard{
		position:absolute; 
		left:210;
		top:19;
	}
	div[elims="true"] > div > div > .resultCard{
		position:absolute; 
		left:640;
		top:19;
	}
	.resultCard[visible="false"]{
		display:none;
	}
	.resultRank{
		position:absolute;
		left:550;
		width:200px;
		text-align:right
	}
	.resultName{
		position:absolute;
		font-size:35px;
		text-overflow: ellipsis;
		overflow:hidden;
		height:62;
		text-align:left;
		line-height:.9;
		top:15;
		width:300;
		left:300;
	}
	div[elims="true"][ad2="true"] > div > div > .resultName{
		left:300;
	}
	
	.resultWinner{
		position:absolute;
		left:400;
		top:760;
		width:800;
		height:93;
		text-align:center;
		color:white;
		font:61px "Arial Black", Arial, Helvetica, sans-serif;
	}
	div[ad2="true"][elims="false"] > .resultWinner{
		top:665;
	}
	.resultWinner[tie="true"]{
		color:black;
	}	
	.resultWinner[visible="false"]{
		display:none;
	}
	.resultBar{
		position:relative;
	}
	div[elims="true"][ad2="false"] > div > .resultBar{
		display:none;
	}
	div[elims="true"][ad2="false"] > div > .resultBarhead{
		position:relative;
		display:block;
	}
	div[elims="true"] > div > div > .resultRank{
		display:none;
	}
	div[elims="false"] > div > div > .resultSeed{
		display:none;
	}
	div[elims="true"] > div > div > .resultSeed{
		position:absolute;
		background-color:white;
		border-radius:50%;
		top:22;
		left:30;
		width:50;
		height:50;
	}
	.resultSeedText{
		position:absolute;
		font:45px "Arial Black", Arial, Helvetica, sans-serif;
		top:-10;
		left:-1;
		width:50;
		text-align:center;
		color:black;
		
	}
	div[elims="true"][ad2="false"] > .seriesResult{
		position:absolute;
		left:400;
		top:460;
		width:800;
		height:93;
		text-align:center;
		color:white;
		font:61px "Arial Black", Arial, Helvetica, sans-serif;
	}
	div[elims="true"][ad2="true"] > .seriesResult{
		position:absolute;
		left:400;
		top:620;
		width:800;
		height:93;
		text-align:center;
		color:white;
		font:61px "Arial Black", Arial, Helvetica, sans-serif;
	}
	div[elims="true"] >  .seriesResult[tie="true"]{
		color:black;
	}
	
	div[elims="false"] > .seriesResult{
		display:none;
	}
	
	#selection{
		position:absolute;
		top:180px;
		left:160px;
	}
	#selection[visible="false"]{
		display:none;
	}
	.selectionBar{
		position:relative;
		height:130px;
		top:60px;
		left:-80;
	}
	.selectionBarImg{
	}
	.selectionSeed{
		position:absolute;
		border-color:black;
		border-radius:50%;
		border-style:solid;
		top:16;
		left:30;
		width:50;
		height:50;
	}
	.selectionSeedText{
		position:absolute;
		font:45px "Arial Black", Arial, Helvetica, sans-serif;
		top:-10;
		left:-1;
		width:50;
		text-align:center;
		color:black;
		
	}
	.selectionTeam{
		position:absolute;
		width:200;
		height:60;
		top:16;
	}
	.selectionTeam1{
		left:100;
	}
	.selectionTeam2{
		left:320;
	}
	.selectionTeam3{
		left:540;
	}
	.selectionText{
		position:relative;
		font:55px "Arial Black", Arial, Helvetica, sans-serif;
		top:-10;
	}
	
	#availableTeams {
		position:absolute;
		left:700;
		top:12;
		font:50px "Lucida Console", Monaco, monospace;
		font-weight:bolder;
		white-space:nowrap;
	}
	#availableTeams h3 {
		margin:2px;
	}
	#available1 {
		position:absolute;
		left:-30;
	}
	#available2 {
		position:absolute;
		left:300;
	}
	#available3 {
		position:absolute;
		left:630;
	}
	.blueField{
		position:absolute;
		left:266; 
		width:266; 
		height:80; 
		background-color:#5995DE;
		float:left;text-align:center;
	}
	.redField{
		position:absolute; 
		left:1064; width:266; 
		height:80; background-color:#DA3434;
		float:left;text-align:center;
	}
	.midField{
		position:absolute; width:532; 
		left:532; float:left;
		text-align:center;
	}
	
	
	#scoreBar{
		position:absolute;
		height:180px;
		width: 1920px;
		#if($ad2)
			left:130px;
			#if($flip)
			top:438px;
			#else
			top:180px;
			#end
		#else
			left:0px;
			top:900px;
		#end
	}
	#scoreBar[visible="false"]{
		display:none;
	}
	.score{
		position:absolute;
		width: 260px;
		font-size: 160px;
		text-align:center;
		color:white;
		#if($ad2)
			#if($flip)
			top:250px;
			#else
			top:851px;
			#end
		#else
			height:180px;
			#if($overlay)
				top: 950px;
				height:130px;
				font-size:130px;
				line-height:130px;
			#else
				top: 900px;
			#end
		#end		
		
	}
	.score[visible="false"]{
		display:none;
	}
	#scoreBlue{
		background-color:blue;
		#if($ad2)			
		left:540;
		#else
		left: 700px;
		#end
		float:left;
	}
	#scoreRed{
		background-color:red;
		#if($ad2)
		left:1120;
		#else
		left: 960px;
		#end
		float:right;
	}
	#if($overlay)
		.relics{
			height:180;
			width:80px;
		}
		#blueRelicSet{			
			float:left;
		}
		#redRelicSet{
			float:right;
		}
		.relic{
			width:80px;
			position:relative;
			left:0; 
			top:10;
		}
		
	#else
		.relics{
			height:340px;
			width:150px;
			float:left;
		}
		.relic{
			position:relative;
			left:40; 
			top:5;
		}
	#end
	
	.relic[visible="false"]{
		display:none;
	}
	.grid{
		position:relative;
		#if($ad2)
			height:340px;
			width: 260px;
			left:50px;
		#else
			height:180px;
			width: 140px;
			top:7px;
			left:10;
		#end
	}
	.gridOverlay{
		
		#if($ad2)
		position:absolute;
		top:-23;
		left:-18;
		#else
		position:absolute;
		top:-14;
		left:-9;
		#end
		z-index:2;
		
	}
	.gridBackground {
		position:absolute;
		left:-2;
	}
	.gridCipher{
		position:absolute;
		#if($ad2)
		top:1;
		left:-2;
		#else
		top:0;
		left:-1;
		#end
		z-index:3;
	}
	.gridCipher[visible="false"]{
		display:none;
	}
	.cell[visible="false"]{
		display:none;
	}
	#gridblue{
		float:left;
	}
	#gridRed{
	#if($ad2)
	float:left;
	#else
		float:right;
		#end
	}
	.parking{
		#if($ad2)
			position:absolute;
			top: 340;
			left:-30;
			width:848;
			
		#else
		position:relative;
		height:180px;
		width: 100px;
		top:4px;
		#end	
	}
	.parking[visible="false"]{
		display:none;
	}
	#parkingBlue{	
		float:left;	
	}
	#parkingRed{
		float:right;
	}
	.balance{
		#if($ad2)
			position:absolute;
			top:480;
			left:-40;
			width:844;
		#else
			position:relative;
			height:180px;
			width: 220px;
			top:5px;
		#end	
	}
	.balance[visible="false"]{
		display:none;
	}
	#balanceBlue{
		float:left;
		#if($overlay)
		right:8px;
		#end
	}
	#balanceRed{
		float: right;
		#if($overlay)
		left:8px;
		#end
	}
	.ball{
		#if($ad2)
			position:absolute;
			height:180px;
			text-align:left;
			top:340;
			left:180;
			width:800;
		#else
			position:relative;
			height:180px;
			width: 100px;
			top:5px;
			/* left:10px; */
			align:center;
		#end
	}
	.ball[visible="false"]{
		display:none;
	}
	#ballBlue{
		float:left;
	}
	#ballRed{
		float:right;
	}

	.overlayWing{
		position: absolute;
		height:50;
		width:100%;
		background-color:white;
		font:35px "Arial Black", Arial, Helvetica, sans-serif;
		
	}
	.blueOverlayWing{
		border: black solid;
		border-radius: 15px 0px 0px 15px;
		border-width:2px 0px 2px 2px;
	}
	.redOverlayWing{
		border: black solid;
		border-radius: 0px 15px 15px 0px;
		border-width:2px 2px 2px 0px;
	}
	.overlayWing[card="true"]{
		background-color:yellow;
	}
	.overlayWing1{
		top:25;
	}
	
	div[teams="3"] > .overlayWing1{	
		top:4;
	}
	.overlayWing2{
		top:105;
	}
	div[teams="3"] > .overlayWing2{
		top:63;
	}
	.overlayWing3{
		display:none;
	}
	div[teams="3"] > .overlayWing3{
		display:block;
		top:121;
	}
	
	.overlayWingSet{
		position:absolute;
		width:130;
		height:180;	
	}
	.overlayWingSet[visible="false"]{
		display:none;
	}
	#blueOverlayWings{
		top:899;
		left:568;
		
	}
	#redOverlayWings{
		top:899;
		left:1220;
	}
	
	
	#chroma{
		position:absolute;
		width:100%;
		height:828;
		background-color:$bgColor;
		z-index:5;
	}
	#chroma[visible="false"]{
		display:none;
	}
	#matchBar{	
		position:absolute;
		text-overflow:ellipsis;
		white-space:nowrap;
		overflow:hidden;
		top:833;
		left:290;
		width:650;
		height:60;
		text-align:center;	
		font:40px "Arial Black", Arial, Helvetica, sans-serif;
	}
	#eventBar{
		position:absolute;
		overflow:hidden;
		text-overflow:ellipsis;
		white-space:nowrap;
		top:833;
		left:978;
		width:870;
		height:60;
		text-align:center;		
		font:38px "Arial Black", Arial, Helvetica, sans-serif;
	}
	
	.wing{
		position:absolute;
		 
		width:294; 
		height:90;
		left:3;
		font:80px "Arial Black", Arial, Helvetica, sans-serif;
		line-height:90px;
			
		text-align:center;
		vertical-align:top;
	}
	div[ad2="false"] > div > div > .wingName{
		display:none;
	}
	div[ad2="true"][timeout="true"] > div > div > .wingName{
		display:none;
	}
	div[ad2="true"][timeout="false"] > div > div > .wingNumber{
		height:100%;
		width:45%;
		float:left;
		
	}
	div[ad2="true"][timeout="false"] > div > div > .wingName{
		float:left;
		width:55%;
		height:100%;
		font:30px "Arial Black", Arial, Helvetica, sans-serif;
		line-height:35px;
		text-align:left;
	}
	
	.wing[visible="false"]{
		display:none;
	}
	
	div[ad2="true"][timeout="false"] > div > .wing{
		width:457; 
		height:75;
		left:3;
		font:60px "Arial Black", Arial, Helvetica, sans-serif;
		line-height:75px;
	}
	
	.blueWing[card=false]{
		background-color:blue;
		color:white;
	}
	div[ad2="true"][timeout="false"] > div > .blueWing[card=false]{
		background-color:white;
		color:black;
		text-align:right;
		
		border-radius:15px 0px 0px 15px;
		border-color:black;
		border-style:solid;
		border-width:3px 0px 3px 3px;
	}	
	.blueWing[card=true]{
		background-color:yellow;
		color:blue;
	}
	div[ad2="true"][timeout="false"] > div > .blueWing[card=true]{
		background-color:yellow;
		color:black;
		text-align:right;
		
		border-radius:15px 0px 0px 15px;
		border-color:black;
		border-style:solid;
		border-width:3px 0px 3px 3px;
		
	}
	.redWing[card=false]{
		background-color:red;
		color:white;
	}
	div[ad2="true"][timeout="false"] > div > .redWing[card=false]{
		background-color:white;
		color:black;
		text-align:left;		
		border-radius:0px 15px 15px 0px;
		border-color:black;
		border-style:solid;
		border-width:3px 3px 3px 0px;
	}	
	.redWing[card=true]{
		background-color:yellow;
		color:red;
	}
	div[ad2="true"][timeout="false"] > div > .redWing[card=true]{
		background-color:yellow;
		color:black;
		text-align:left;
		
		border-radius:0px 15px 15px 0px;
		border-color:black;
		border-style:solid;
		border-width:3px 3px 3px 0px;
	}	
	#redWing{	
		position:absolute;
		background-color:red;
		width:300;
		height:200;
		top:162;
		left:765;
	}
	#redWing[teams="3"]{
		position:absolute;
		background-color:red;
		width:300;
		height:300;
		top:112;
		left:765;
	}
	div[ad2="true"][timeout="false"] > #redWing{
		position:absolute; 
		background-color:transparent;
		width:460;
		height:250;
		top:-70;
		left:578;
	}
	div[ad2="true"][timeout="false"] > #redWing[teams="3"]{
		background-color:transparent;
		width:460;
		height:250;
		top:-70;
		left:578;
	}

	
	#blueWing{
		position:absolute;
		background-color:blue;
		width:300;
		height:200;
		top:162;
		left:-300;
	}
	#blueWing[teams="3"]{
		position:absolute;
		background-color:blue;
		width:300;
		height:300;
		top:112;
		left:-300;
	}
	div[ad2="true"][timeout="false"] > #blueWing{
		background-color:blue;
		background-color:transparent;
		width:460;
		height:250;
		top:-70;
		left:-723;
	}
	div[ad2="true"][timeout="false"] > #blueWing[teams="3"]{
		position:absolute;
		background-color:transparent;
		width:460;
		height:250;
		top:-70;
		left:-723;
	}
	
	.wing1{
		top:3;
	}
	
	div[ad2="true"][timeout="false"] > div[teams="2"] >.wing1{
		top:40;
	}
	
	div[ad2="true"][timeout="false"]> div > .wing2{
		top:88;
	}
	div[ad2="true"][timeout="false"] > div[teams="2"] >.wing2{
		top:150;
	}
	
	.wing2{
		top:103;
	}
	div[ad2="true"][timeout="false"]> div > .wing3{
		top:173;
	}
	
	.wing3{
		top:203;
	}
	
	body {
		overflow:hidden;
		max-width:100%;
		max-height:100%;
		margin:0;
		padding:0;
		background:black;
	}
	#body {
		background-repeat:no-repeat;
		background-image:url(#if($ad2 == "true")'/img/DisplayBackgroundHD_expanded.png'#else'/img/BackgroundHD.png'#end);
		width:100%;
		height:100%;
		position:absolute;
	}
	
	.toBar{
		position:absolute;
		left:-506;
		top:724;
		width:1732;
		height:93;
		text-align:center;
		font:61px "Arial Black", Arial, Helvetica, sans-serif;
	}
	.toBar[visible="false"]{
		display:none;
	}
	
	.chevron[visible="true"]{
		position:absolute;
		z-index:2;
	}
	.chevron[visible="false"]{
		display:none;
	}
	
	
	.chevronR{
		left:-23;
	}
	.chevronR[flip="true"]{
		left:237;
	}
	
	.chevronC{
		top:-19;
	}
	
	##Taken from https://www.w3schools.com/css/tryit.asp?filename=trycss3_animation2
	.gameOverAnim {
    	background-color: #FF0000;
    	-webkit-animation-name: gameOverAnimStyle; /* Safari 4.0 - 8.0 */
    	-webkit-animation-duration: 3s; /* Safari 4.0 - 8.0 */
    	-webkit-animation-iteration-count: 2;
    	animation-name: gameOverAnimStyle;
	    animation-duration: 3s;
	    animation-iteration-count: 2;
	}

	/* Safari 4.0 - 8.0 */
	@-webkit-keyframes gameOverAnimStyle {
	    0%   {background-color: #FF0000;}
		25% {background-color: #FF7777;}
		50%  {background-color: #FF0000;}
		75% {background-color: #FF7777;}
		100%  {background-color: #FF0000;}
	}

	/* Standard syntax */
	@keyframes gameOverAnimStyle {
		0%   {background-color: #FF0000;}
		25% {background-color: #FF7777;}
		45%  {background-color: #FF0000;}
		75% {background-color: #FF7777;}
		100%  {background-color: #FF0000;}
	}
	
	</style>

<body>
<div align=center id="body">
	<script src="/js/jquery-1.12.4.js"></script>
  	<script src="/js/jquery-ui.js"></script>
  	<script src="/js/general.js"></script>
  	
  	<font face="Arial Black Custom"></font>
  	
  	<audio preload="auto" id="charge">
  	<source src="/audio/charge.wav" type="audio/wav">
  	</audio>
  	<audio preload="auto" id="endauto">
  	<source src="/audio/endauto_with_warning.wav" type="audio/wav">
  	</audio>
  	<audio preload="auto" id="teleop321">
  	<source src="/audio/3-2-1.wav" type="audio/wav">
  	</audio>
  	<audio preload="auto" id="firebell">
  	<source src="/audio/firebell.wav" type="audio/wav">
  	</audio>
  	<audio preload="auto" id="factwhistle">
  	<source src="/audio/factwhistle.wav" type="audio/wav">
  	</audio>
  	<audio preload="auto" id="endmatch">
  	<source src="/audio/endmatch.wav" type="audio/wav">
  	</audio>
  	<audio preload="auto" id="fogblast">
  	<source src="/audio/fogblast.wav" type="audio/wav">
  	</audio>
  	<div id="top">
  		Match 1
  	</div>
  	#if($overlay)
  		<div id="chroma" visible="true">
  		</div>
  	#end
  	<div id="timer" visible="true" ad2="$ad2" timeout="false">
	  	<img class="timerImage" id="minDigit" src="/digits/Wdigitoff.png" alt="DigitOff" >
	  	<img class="timerImage" id="colon" src="/digits/Wcolon.png" alt="colon">
	  	<img class="timerImage" id="tensDigit" src="/digits/Wdigitoff.png" alt="DigitOff" >
	  	<img class="timerImage" id="onesDigit" src="/digits/Wdigitoff.png" alt="DigitOff" > 
	  	<div id="blueWing" teams="2">
	  		<div id="blueWing1" class="wing blueWing wing1" card=false>
	  			<div class="wingName">
	  			</div>
	  			<div class="wingNumber">
	  			</div>
	  		</div>
	  		<div id="blueWing2"  class="wing blueWing wing2" card=false>
	  			<div class="wingName">
	  			</div>
	  			<div class="wingNumber">
	  			</div>
	  		</div>
	  		<div id="blueWing3"  class="wing blueWing wing3" card=false visible="false">
	  			<div class="wingName">
	  			</div>
	  			<div class="wingNumber">
	  			</div>
	  		</div>
	  	</div> 	
	  	<div id="redWing" teams="2">
	  		<div id="redWing1" class="wing redWing wing1" card=false>
	  			<div class="wingNumber">
	  			</div>
	  			<div class="wingName">
	  			</div>
	  		</div>
	  		<div id="redWing2" class="wing redWing wing2" card=false>
	  			<div class="wingNumber">
	  			</div>
	  			<div class="wingName">
	  			</div>
	  		</div>
	  		<div id="redWing3" class="wing redWing wing3" card=false visible="false">
	  			<div class="wingNumber">
	  			</div>
	  			<div class="wingName">
	  			</div>
	  		</div>
	  	</div> 
	  	<img id="timeoutBarImg" class="toBar" src="/img/alliancebar200.png" alt="toBar" visible="false">
  		#if($ad2)
  		<div id="progressBar">
    		<div id="progress" style="width:0%">
    		</div>
    		
  		</div>
  		#end
  		<div id="timeoutBar" class="toBar" visible="false">Alliance Timeout Window Expired</div>
  	
  	</div>
  	<div id="random" visible="false">
  		<img id="randomImg" src="/img/random1_75.png" alt="Randomization" >
  	</div>
  	<div id="preview" visible="false">
  		#previewBar("red" "1")
  		#previewBar("red" "2")
  		#previewBar("red" "3")
  		
  		<br><br><br>
  		#previewBar("blue" "1")
  		#previewBar("blue" "2")
  		#previewBar("blue" "3")
  		
  		<img id="seriesStatusImg" class="resultWinner" src="/img/alliancebar92.png" alt="winner" visible="false">
  		<div id="seriesStatus" class="resultWinner" visible="false">Series Tied</div>
  	</div>
  	<div id="result" visible="false" elims="false" ad2=$ad2 >
  		<div id="blueResultBars" class="resultBars">
  			#resultBar("blue" "head")
  			#resultBar("blue" "1")
  			#resultBar("blue" "2")
  		</div>
  		<div id="redResultBars" class="resultBars">
  			#resultBar("red" "head")
  			#resultBar("red" "1")
  			#resultBar("red" "2")
  		</div>
  		<div id="resultFields" class="resultFields">
  		<br>
  			#resultField ("Points Scored" "score")
  			<br>
  			#resultField ("Penalty Points" "penalty")
  			<br>
  			#resultField ("Total Points" "total")
  		</div>
  		<img id="seriesResultImg" class="seriesResult" src="/img/alliancebar92.png" alt="winner" visible="false">
  		<div id="seriesResult" class="seriesResult" visible="false">Series Tied</div>
  		
  		<img id="winnerImg" class="resultWinner" src="/img/alliancebar92.png" alt="winner">
  		<div id="winnerField" class="resultWinner">Series Tied!</div>
  	</div>
  	<div id="selection" visible="false">
  		#selectionBar(1)
  		#selectionBar(2)
  		#selectionBar(3)
  		#selectionBar(4)
  		<div id="availableTeams">
			<div id="available1"></div>
			<div id="available2"></div>
			<div id="available3"></div>
  		</div>
  	</div>
  	
  	
  	<div id="scoreBar" >
  		
  		#if($ad2)
  		<div style="float:left; width: 750px;height:1000px;">
	  	#end
	  		#grid("blue" $cbSize "1")
	  		#if($ad2)
	  		<div class="relics">
	  			<img class="relic" id="blueRelic1" src="/img/relic_blue_1.png" alt="relic" visible="false" >
	  			<img class="relic" id="blueRelic2" src="/img/relic_blue_3_side.png" alt="relic" visible="false">
	  		</div>
	  		#end
	  		#grid("blue" $cbSize "2")
	  		#ball("blue" $jSize)
	  		#parking("blue" $pSize)
	  		#if($overlay)
		  		<div class="relics" id="blueRelicSet">		  		
		  			<img class="relic" id="blueRelic1" src="/img/relic_black.png" alt="relic" visible="false" >
		  			<img class="relic" id="blueRelic2" src="/img/relic_black.png" alt="relic" visible="false" >
		  		</div>
	  		#end
	  		#balance("blue" $bSize)	
	  	#if($ad2)  		  		
  			</div>
  			<div style="float:left; position:relative;left:150;width:750px;">  		
  		#end
  		#grid("red" $cbSize "1")
  		#if($ad2)
  			<div class="relics">	  		
	  			<img class="relic" id="redRelic1" src="/img/relic_red_3_side.png" alt="relic" visible="false" >
	  			<img class="relic" id="redRelic2" src="/img/relic_red_3_side.png" alt="relic" visible="false" >
	  		</div>
  		#end
  		#grid("red" $cbSize "2")
  		#ball("red" $jSize) 	
  		#parking("red" $pSize)
  		#if($overlay)
  			<div class="relics" id="redRelicSet">
	  			<img class="relic" id="redRelic1" src="/img/relic_black.png" alt="relic" visible="false" >
	  			<img class="relic" id="redRelic2" src="/img/relic_black.png" alt="relic" visible="false" >
	  		</div>
  		#end
  		#balance("red" $bSize)   		
  			
  		#if($ad2)  		
  		</div>
  		#end
  			
  	</div>
  	
  	<div id="scoreBlue" class="score">0</div>
  	<div id="scoreRed" class="score" >0</div>
  	#if($overlay)
  		<div id="matchBar">Match 1</div>
  		<div id="eventBar">$eventName</div>
  		<div id="progressBar" overlay="true">
    		<div id="progress" style="width:0%"></div>
			<div id="progressTime">
				150
			</div>
			<div id="progressHighlight">
			</div>
  		</div>
  		<div id="blueOverlayWings" class="overlayWingSet" teams="2">
  			<div id="blueOverlayWing1" class="blueOverlayWing overlayWing overlayWing1">
  			</div>
  			<div id="blueOverlayWing2" class="blueOverlayWing overlayWing overlayWing2">
  			</div>
  			<div id="blueOverlayWing3" class="blueOverlayWing overlayWing overlayWing3">
  			</div>
  		</div>
  		<div id="redOverlayWings" class="overlayWingSet" teams="2">
  			<div id="redOverlayWing1" class="redOverlayWing overlayWing overlayWing1">
  			</div>
  			<div id="redOverlayWing2" class="redOverlayWing overlayWing overlayWing2">
  			</div>
  			<div id="redOverlayWing3" class="redOverlayWing overlayWing overlayWing3">
  			</div>
  		</div>
  		
  		
  	#end

  	<script>
  	
  	var startSound = document.getElementById("charge");
  	var endAutoSound = document.getElementById("endauto");
  	var countSound = document.getElementById("teleop321");
  	var teleopSound = document.getElementById("firebell");
  	var endgameSound = document.getElementById("factwhistle");
  	var buzzerSound = document.getElementById("endmatch");
  	var foghornSound = document.getElementById("fogblast");
  	var timeout = false;
  	var timeoutLength = 300000; //Field timeout is 5 min. Alliance adds 3 min (180000)
  	var allianceTimeoutLength = 180000;
  	var allianceTO = 0;
  	var startTime = 0;
  	var pauseStart = 0;
  	var paused = false;
  	var timerInstance;
  	var elapsed;
  	var waitingForServerTime = false;
  	var prevTick;
  	var endAutoFlag = false;
  	var countFlag = false;
  	var teleopFlag = false;
  	var endgameFlag = false; 
  	var firstTickSinceReload = false;
  	var rand;
  	
  	var stopScores = false;
  	
  	
  	var minDigit = document.getElementById("minDigit");
  	var colon = document.getElementById("colon");
  	var tensDigit = document.getElementById("tensDigit");
  	var onesDigit = document.getElementById("onesDigit");
  	var blueParking1 = document.getElementById("parkingblue1");
  	var blueParking2 = document.getElementById("parkingblue2");
  	var redParking1 = document.getElementById("parkingred1");
  	var redParking2 = document.getElementById("parkingred2");
  	var blueJewel1 = document.getElementById("jewelblue1");
  	var blueJewel2 = document.getElementById("jewelblue2");
  	var redJewel1 = document.getElementById("jewelred1");
  	var redJewel2 = document.getElementById("jewelred2");
  	var redBalance1 = document.getElementById("balancered1");
  	var redBalance2 = document.getElementById("balancered2");
  	var blueBalance1 = document.getElementById("balanceblue1");
  	var blueBalance2 = document.getElementById("balanceblue2");
  	
  	$().ready(function () {
  		var zoom = $("#body").width() / 1920;
  		$("#body").css("zoom", zoom);
  		//$("#body").css("top", ($("body").height() - zoom * $("body").height()) / 2);
    	getTimerCommand();
    	getDisplayCommand();
   // 	getMatchInfo();
    	getMatchTime();
	});
	
	function getMatchTime() {
		waitingForServerTime = true;
		var cur = new Date().getTime(); //we are going to measure network time
  		console.log('cur elapsed: ' + elapsed);
  		$.ajax({
			url: "../time/",
			type: "GET",
			dataType: 'json',
			success: function(data, textStatus, xhr){
				if (xhr.status != 200 && xhr.status != 209) {
					return 158*1000; //we are not in a match and we are not paused, so give up
				}
				// the data is the elapsed time in ms. We think the current elapsed time is actually
				// what the server says plus half of the elapsed time to account for network lag
				var rn = new Date().getTime();
				elapsed = data + (rn - cur) / 2;
				prevTick = rn;
				startTime = rn - elapsed; //we should now be reset to correct time
				console.log('new elapsed: ' + elapsed);
				if (timerInstance == null) { 
					if (xhr.status == 200) {//we loaded a page in the middle of a match, start the timer
						timeout = false;
						firstTickSinceReload = true;
	  					stopScores = false;
  						timerInstance = setInterval(tick, 50);
  						paused = false;
  						endAutoFlag = false;
 	 					countFlag = false;
  						teleopFlag = false;
  	    				endgameFlag = false;
  	    				getMatchInfo();
  						 $.ajax({
				                url: "../random/",
				                type: "GET",
				                dataType: 'json',
				                success: function (data) {
				                    rand=data.rand;
  									getScoreUpdate(false);
				                },
				                error: function () {
				                	//try scores anyway.
  									getScoreUpdate(false);
				                    //ERROR HANDLING
				                    console.log("Error");
				                  }});
  						var tmr = document.getElementById("timer");
  						showMatch();
  					} else if (xhr.status == 209) { //we laoded a page with the match paused
  						//TODO
  					}
				}
				waitingForServerTime = false;
			},
			error:function(xhr, ajaxOptions, thrownError){
				console.log(xhr);
				console.log(ajaxOptions);
				console.log(thrownError);
				waitingForServerTime = false;
		}});
		return elapsed; //since elapsed is global this doesn't really matter
	}
	
	function getTimerCommand()
	{
	//TODO maybe adjust this so it sends last command, and if different, it returns immediately with last command
	//essentially make it a block if different
        $.ajax({
            url: "../time/command/",
            type: "GET",
            success: function (data) {
            	console.log(data);
            	if(data.indexOf("<html>")>=0){
            		//weve been redirected to login page!
            		window.location.reload(true);
            	}
            	data = data.split(",");
            
        		if(data[0] == "FIELD_TO"){
        			fieldTimeout();
        		}
        		if(data[0] == "TEAM_TO"){
        			allianceTimeout();
        		}
            
            	#if($field)
            		if(data[1] != $field && data[1] != "-1"){
            			getTimerCommand();
            			return;
            		}
            	#end
            	if(data[0] == 'START'){
            		start();
            	} else if(data[0] == 'PAUSE'){
            		pause();
            	} else if(data[0] == 'RESUME'){
            		resume();
            	} else if(data[0] == "RESET"){
            		reset();
            	}
            	getTimerCommand();
            },
            error: function () {
            	//TODO this should turn into get Last command, since we mught have missed some
                window.setTimeout(getTimerCommand, 5000);
            }});

	}
	
  	function start(){
  		timeout = false;
  		stopScores = false;
  		startTime = new Date().getTime();
  		prevTick = startTime;
  		timerInstance = setInterval(tick, 50);
  		startSound.play();
  		paused = false;
  		endAutoFlag = false;
 	 	countFlag = false;
  		teleopFlag = false;
  	    endgameFlag = false;
  		getScoreUpdate(false);
  		var tmr = document.getElementById("timer");
  	//	if(tmr.getAttribute("visible") == "false" ){
  			showMatch();
  	//	}
  	}
  	function pause(){
  		pauseStart = new Date().getTime();
  		window.clearInterval(timerInstance);
  		timerInstance = null;
  		paused = true;  		
  	}
  	function resume(){
  		var offset = new Date().getTime() - pauseStart;
  		startTime += offset;
  		//prevTick += offset;
  		timerInstance = setInterval(tick, 50);
  		paused = false;
  	}
  	function reset(){
  		foghornSound.play();
  		stopScores = true;
  		window.clearInterval(timerInstance);
  		timerInstance = null;
  		display(150, 'W');
  	}
  	
  	function fieldTimeout(){
  		allianceTO = 0;
  		timeout = true;
  		startTime = new Date().getTime();
  		prevTick = startTime;
  		timerInstance = setInterval(tick, 50);
  		#if(!$ad)
  			showTimeout();
  		#end
  	}
  	function allianceTimeout(){
  		allianceTO++;
 		if(!timeout){
 			timeout = true;
 			startTime = new Date().getTime() - timeoutLength; //due to math in tick, pretend field timeout just expired
 			prevTick = startime;
  			timerInstance = setInterval(tick, 50);
 			#if(!$ad)
  				showTimeout();
  			#end
 		}
  		
  	}
  	function endTimeout(){
  	}
  	function showTimeout(){
  		showMatch();
  		document.getElementById("timer").setAttribute("timeout", "true");
  		document.getElementById("top").innerHTML = "Timeout In Progress";
  		//at bottom show "Alliance Timeout Window: 3:00" / "Alliance Timeout Called"/ "Alliance Timeout Window Expired"
  		document.getElementById("scoreBar").setAttribute("visible", "false");
  		document.getElementById("scoreRed").setAttribute("visible", "false");
  		document.getElementById("scoreBlue").setAttribute("visible", "false");
  		document.getElementById("timeoutBar").setAttribute("visible", "true");
  		document.getElementById("timeoutBarImg").setAttribute("visible", "true");
  		document.getElementById("selection").setAttribute("visible","false");
  		#if($overlay)
  			document.getElementById("chroma").setAttribute("visible", "false");
  			document.getElementById("progressBar").setAttribute("visible", "false");
  			document.getElementById("redOverlayWings").setAttribute("visible", "false");
  			document.getElementById("blueOverlayWings").setAttribute("visible", "false");
  		#end
  	
  	}
  	
  	
  	function display(sec, color){
  	//THis is a ceiling becuase the value that needs to be floored is subtracted from a constant in the calling method
  		sec = Math.ceil(sec);
  		var d = document.getElementById("timer");
  		var min = Math.floor(sec / 60);
  		var s = sec % 60;
  		minDigit.src = "/digits/"+color+min+".png"
  		tensDigit.src= "/digits/"+color+Math.floor(s/10)+".png";
  		onesDigit.src = "/digits/"+color+s%10+".png";
  		colon.src = "/digits/"+color+"colon.png";
  		//d.innerHTML = min+":"+ (s < 10 ? "0" : "") + s;
  		#if($overlay)
  			if (sec > 120) {
  				sec = sec - 120;
  			}
  			document.getElementById("progressTime").innerHTML = sec;
  		#end
  	}
  	function tick(){
  		if (waitingForServerTime) { // we are current synchronously waiting in a previous tick for a time update, thus we need to skip this tick and we will catch up later
  			return;
  		}
  		var cur = new Date().getTime();
  		elapsed = cur - startTime;
  		if (Math.abs(cur - prevTick) > 500) { //our system time is messed up, need to reset
  			console.log(prevTick);
  			console.log(cur);
  			console.log((cur - prevTick) + ' asking server');
  			getMatchTime();
  			return; //we are giving up on this tick
  		}
  		prevTick = cur;
  		if(timeout){
  			var left = ( timeoutLength + (allianceTO * allianceTimeoutLength) -elapsed );
  			display( left  / 1000 , "W");
  			if(left <= 0){  				
  				buzzerSound.play();
  				display(0, "W");
  				window.clearInterval(timerInstance);
  				timerInstance = null;
  				return;
  			}
  			//display alliance timeout window
  			var x = "";
  			if(allianceTO > 0){
  				x = "Alliance Timeout Called";
  			} else{
  				if(left < 120000){
  					x = "Alliance Timeout Window Expired";
  				} else{
  					x = "Alliance Timeout Window: ";
  					var y = Math.ceil((left - 120000)/1000);
  					x += Math.floor(y/60) + ":";
  					var z = y % 60;
  					if(z < 10) x+= "0";
  					x += z;  					
  				}
  			}
  			document.getElementById("timeoutBar").innerHTML = x;
  			document.getElementById("progress").style.width = '0%';
  			return;
  		}
  		
  		#if($ad2 || $overlay)
  			document.getElementById("progress").style.width = (elapsed * 100 / 158000)+'%';
  		#end
  		if (elapsed < 30000){
  			//autonomous
  			  	#if($ad2 || $overlay)
  					document.getElementById("progress").style.backgroundColor = "green"; //yellow for endgame
  				#end
  			display(150 - (elapsed/1000), "W");
  		} else if(elapsed < 35000){
  			//end of auto, sound buzzer on first time. start 5 second pickup time
  			if(!endAutoFlag){
  				if (!firstTickSinceReload) {
  					endAutoSound.play();
  				}
  				endAutoFlag = true;
  			}
  			display(5 - (elapsed-30000)/1000, "Y");
  		} else if(elapsed < 38000){
  			//sound 3,2,1...
  			if(!countFlag){
  				countFlag = true;
  				if (!firstTickSinceReload) {
  					countSound.play();
  				}
  			}
  			display(3 - (elapsed-35000)/1000, "R");
  		} else if(elapsed < 128000){
  			//start teleop on first time, sound ding ding ding
  			if(!teleopFlag){
  				teleopFlag = true;
  				if (!firstTickSinceReload) {
  					teleopSound.play();
  				}
  			}
  			display(120 - (elapsed-38000)/1000, "W");
  		} else if(elapsed < 158000){
  			//Start endgame, sound train whistle
  			if(!endgameFlag){
  				endgameFlag = true;
  				if (!firstTickSinceReload) {
  					endgameSound.play();
  				}
  				#if($ad2 || $overlay)
  					document.getElementById("progress").style.backgroundColor = "#FFFF00"; //yellow for endgame
  				#end
  				#if($overlay)
	  				swapOverlay();
	  			#end
	  			}
  			display(30 - (elapsed-128000)/1000, "W");
  		} else{
  			//End of match, sound buzzer.
  			//stop timer! (return)
  			if (!firstTickSinceReload) {
  				buzzerSound.play();
  				#if($ad2 || $overlay)
  					document.getElementById("progress").classList.add('gameOverAnim');
  					setTimeout(function() {
	  					document.getElementById("progress").classList.remove('gameOverAnim');
  						document.getElementById("progress").style.backgroundColor = "#FF0000";
  					}, 6000);
  				#end
  			} else {
  				#if($ad2 || $overlay)
  					document.getElementById("progress").style.backgroundColor = "#FF0000";
  				#end
  			}
  			display(0, "W");
  			window.clearInterval(timerInstance);
  			timerInstance = null;
  			timeout = false;
  			allianceTO = 0;
  			firstTickSinceReload = false;
  			return;
  		}
  		firstTickSinceReload = false;
  	}
  	display(150, "W");
  	
  	//TODO wait for load match timer command
  	
  	function getDisplayCommand()
	{
		//TODO maybe adjust this so it sends last command, and if different, it returns immediately with last command
		//essentially make it a block if different
        $.ajax({
            url: "../display/command/",
            type: "GET",
            success: function (data, textStatus, xhr) {
            	console.log(data);
            	if(data.indexOf("<html>")>=0){
            		//weve been redirected to login page!
            		window.location.reload(true);
            	}
            	data = data.split(",");
            	#if($field)
            		if(data[1] != $field && data[1] != "-1"){
            			getDisplayCommand();
            			return;
            		}
            	#end
            	if(data[0] == "SHOW_TO"){
            		showTimeout();
            	}
            	if(data[0] == 'SHOW_RANDOM'){
            		resetScores();
            		showRandom();
            		stopScores = true;
            		#if(!$ad)getMatchInfo();#end
            	} else if(data[0] == 'SHOW_MATCH'){
            		getMatchInfo();
            		showMatch();
            	} else if(data[0] == 'STOP_SCORE_UPDATES'){
            		stopScores = true;
            	}
            	
            		else if(data[0] == 'SHOW_PREVIEW'){
            			$.ajax({
				  			url: "../match/",
				  			type: "GET",
				  			dataType: 'json',
				  			success: function(data){
				  				#if($ad)
				  					showPreview(data);
				  					resetScores();
				  				#else
				  					fillWings(data);
				  				#end
				  			},
				  			error:function(xhr, ajaxOptions, thrownError){
					                    console.log(xhr);
					                    console.log(ajaxOptions);
					                    console.log(thrownError);
				  			}});
            		} 
            		#if($ad)
            		else if(data[0] == 'SHOW_RESULT'){
            			$.ajax({
				  			url: "../display/resultdata/",
				  			type: "GET",
				  			dataType: 'json',
				  			success: function(data){
				  				showResult(data);
				  			},
				  			error:function(xhr, ajaxOptions, thrownError){
					                    console.log(xhr);
					                    console.log(ajaxOptions);
					                    console.log(thrownError);
				  			}});
            		} else if(data[0] == 'SHOW_SELECTION'){
            			$.ajax({
				  			url: "../display/selectiondata/",
				  			type: "GET",
				  			dataType: 'json',
				  			success: function(dat){
				  				showSelection(dat);
				  			},
				  			error:function(xhr, ajaxOptions, thrownError){
					                    console.log(xhr);
					                    console.log(ajaxOptions);
					                    console.log(thrownError);
				  			}});
            		}
            	#end
            	getDisplayCommand();
            },
            error: function () {
            	//TODO this should turn into get Last command, since we mught have missed some
                window.setTimeout(getDisplayCommand, 5000);
            }
         });

	}
	//Gets team numbers and card info to display beside the timer.
	function getMatchInfo(){
		$.ajax({
  			url: "../match/",
  			type: "GET",
  			dataType: 'json',
  			success: function(data){
  				fillWings(data);
  			},
  			error:function(xhr, ajaxOptions, thrownError){
	                    console.log(xhr);
	                    console.log(ajaxOptions);
	                    console.log(thrownError);
  			}});
	}
	function setTop(n){
		if(n.indexOf("F") >= 0){
			if(n.indexOf("SF") >= 0){
				var sf = n.substring(3);
				var m = sf.substring(sf.indexOf('-')+1);
				sf = sf.substring(0, sf.indexOf('-'));
				n = "Semifinal "+sf+" Match "+m;
			} else{
				n = "Finals Match " + n.substring(n.indexOf("F")+2);
			}
		}
		document.getElementById("top").innerHTML = n;//n == -1 ? "Test Match" : ("Qualification Match "+n);
		#if($overlay)
			document.getElementById("matchBar").innerHTML = n;
		#end
	}
	function fillWings(data){
		var wing = document.getElementById("blueWing1");
		wing.getElementsByClassName("wingNumber")[0].innerHTML = data.blue1;
		wing.getElementsByClassName("wingName")[0].innerHTML = data.blue1Name;
		wing.setAttribute("card", data.blue1Card);
		
		wing = document.getElementById("blueWing2");
		
		wing.getElementsByClassName("wingNumber")[0].innerHTML = data.blue2;
		wing.getElementsByClassName("wingName")[0].innerHTML = data.blue2Name;
		
		wing.setAttribute("card", data.blue2Card);
		
		wing = document.getElementById("redWing1");
		wing.getElementsByClassName("wingNumber")[0].innerHTML = data.red1;
		wing.getElementsByClassName("wingName")[0].innerHTML = data.red1Name;
		wing.setAttribute("card", data.red1Card);
		
		wing = document.getElementById("redWing2");
		wing.getElementsByClassName("wingNumber")[0].innerHTML = data.red2;
		wing.getElementsByClassName("wingName")[0].innerHTML = data.red2Name;
		wing.setAttribute("card", data.red2Card);
		
		#if($overlay)
			wing = document.getElementById("redOverlayWing1");
			wing.innerHTML = data.red1;
			wing.setAttribute("card", data.red1Card);
			wing = document.getElementById("redOverlayWing2");
			wing.innerHTML = data.red2;
			wing.setAttribute("card", data.red2Card);
			
			wing = document.getElementById("blueOverlayWing1");
			wing.innerHTML = data.blue1;
			wing.setAttribute("card", data.blue1Card);
			wing = document.getElementById("blueOverlayWing2");
			wing.innerHTML = data.blue2;
			wing.setAttribute("card", data.blue2Card);
		#end
		
		if(typeof data.red3 !== 'undefined' && data.red3 > 0){
			wing = document.getElementById("redWing3");
			wing.getElementsByClassName("wingNumber")[0].innerHTML = data.red3;
			wing.getElementsByClassName("wingName")[0].innerHTML = data.red3Name;
		
			wing.setAttribute("card", data.red1Card);
			wing.setAttribute("visible", "true");
			
			wing = document.getElementById("blueWing3");
			
			wing.getElementsByClassName("wingNumber")[0].innerHTML = data.blue3;
			wing.getElementsByClassName("wingName")[0].innerHTML = data.blue3Name;
		
			wing.setAttribute("card", data.blue1Card);
			wing.setAttribute("visible", "true");
			
			document.getElementById("blueWing").setAttribute("teams","3");		
			document.getElementById("redWing").setAttribute("teams","3");
			
			#if($overlay)
				document.getElementById("blueOverlayWings").setAttribute("teams", "3");
				document.getElementById("redOverlayWings").setAttribute("teams", "3");
				
				wing = document.getElementById("blueOverlayWing3");
				wing.innerHTML = data.blue3;
				wing.setAttribute("card", data.blue1Card);
				wing = document.getElementById("redOverlayWing3");
				wing.innerHTML = data.red3;
				wing.setAttribute("card", data.red1Card);
			#end
			
		} else{
		  	document.getElementById("blueWing").setAttribute("teams","2");		
			document.getElementById("redWing").setAttribute("teams","2");			
			#if($overlay)
				document.getElementById("blueOverlayWings").setAttribute("teams", "2");
				document.getElementById("redOverlayWings").setAttribute("teams", "2");
			#end
		}
		
		setTop(data.name);
	}
	
	function resetScores(){
		//TODO reset all the images and scores to pre-match values
		var obj = {
			red:{
				parkingPoints:0,
				jewelSet1:3,
				jewelSet2:3,
				cryptobox1:0,
				cryptobox2:0,
				balanced:0,
				teleopPoints:0,
				autoPoints:0,
				foulPoints:0
			},
			blue:{
				parkingPoints:0,
				jewelSet1:3,
				jewelSet2:3,
				cryptobox1:0,
				cryptobox2:0,
				balanced:0,
				teleopPoints:0,
				autoPoints:0,
				foulPoints:0
			}
		}
		updateScores(obj);
	}
	
	function showPreview(data){
		
		var elims = typeof data.red3 !== 'undefined';
		
		document.getElementById("preview").setAttribute("elims", elims ? "true" : "false");
		
  		display( 150  , "W");
  		#if($ad2 || $overlay)
  		document.getElementById("progress").style.width = '0%';
  		#end
  		#if($overlay)
  			document.getElementById("chroma").setAttribute("visible", "false");
  			document.getElementById("progressBar").setAttribute("visible", "false");
  			document.getElementById("redOverlayWings").setAttribute("visible", "false");
  			document.getElementById("blueOverlayWings").setAttribute("visible", "false");
  			
  			var balls = document.getElementsByClassName("ball");
  			var parking = document.getElementsByClassName("parking");
  			var balance = document.getElementsByClassName("balance");
  			var relics = document.getElementsByClassName("relic");
  			
  			for(var i = 0; i < balls.length; i++){
  				balls[i].setAttribute("visible", "true");
  			}
  			for(var i = 0; i < parking.length; i++){
  				parking[i].setAttribute("visible", "true");
  			}
  			for(var i = 0; i < balance.length; i++){
  				balance[i].setAttribute("visible", "false");
  			}
  			for(var i = 0; i < relics.length; i++){
  				relics[i].setAttribute("visible", "false");
  			}
  		#end

		document.getElementById("red1_number").innerHTML = data.red1;
		document.getElementById("red1_name").innerHTML = data.red1Name;
		document.getElementById("red1_rank").innerHTML = data.red1Rank == -1 || elims ? "" : data.red1Rank;
		document.getElementById("red2_number").innerHTML = data.red2;
		document.getElementById("red2_name").innerHTML = data.red2Name;
		document.getElementById("red2_rank").innerHTML = data.red2Rank == -1 || elims ? "" : data.red2Rank;
		if(elims & data.red3 != 0){
			document.getElementById("red3_number").innerHTML = data.red3;
			document.getElementById("red3_name").innerHTML = data.red3Name;
		}
		document.getElementById("blue1_number").innerHTML = data.blue1;
		document.getElementById("blue1_name").innerHTML = data.blue1Name;
		document.getElementById("blue1_rank").innerHTML = data.blue1Rank == -1 || elims ? "" : data.blue1Rank;
		document.getElementById("blue2_number").innerHTML = data.blue2;
		document.getElementById("blue2_name").innerHTML = data.blue2Name;
		document.getElementById("blue2_rank").innerHTML = data.blue2Rank == -1 || elims ? "" : data.blue2Rank;
		if(elims & data.blue3 != 0){
			document.getElementById("blue3_number").innerHTML = data.blue3;
			document.getElementById("blue3_name").innerHTML = data.blue3Name;
		}
		setTop(data.name);
	
		document.getElementById("timer").setAttribute("timeout", "false");
		document.getElementById("timer").setAttribute("visible", #if($ad2)elims ? "false" : "true"#else"false"#end);
		document.getElementById("random").setAttribute("visible","false");
		document.getElementById("preview").setAttribute("visible","true");
		document.getElementById("result").setAttribute("visible","false");
		document.getElementById("scoreRed").setAttribute("visible",elims ? "false" : "true");
		document.getElementById("scoreBlue").setAttribute("visible",elims ? "false" : "true");
		document.getElementById("scoreBar").setAttribute("visible", #if($ad2) "false" #else elims ? "false" : "true"#end);
		document.getElementById("selection").setAttribute("visible","false");
		
		var statImg = document.getElementById("seriesStatusImg");
		var stat = document.getElementById("seriesStatus");
		statImg.setAttribute("visible",elims ? "true" : "false");
		stat.setAttribute("visible", elims ? "true" : "false");
		if(elims){
			if(data.redWins == data.blueWins){
				stat.innerHTML = "Series Tied " + data.redWins + " - "+data.blueWins;
				stat.setAttribute("tie","true");
				statImg.src = "/img/alliancebar92.png";
	
			} else {
				stat.innerHTML = (data.redWins > data.blueWins ? "RED" : "BLUE") + " leads series";
				statImg.src = "/img/alliance"+(data.redWins > data.blueWins ? "red" : "blue") + "92.png";
				
				stat.setAttribute("tie","false");
			}
		} 
	
		fillWings(data);
	}
	function swapOverlay(){
		var balls = document.getElementsByClassName("ball");
		var parking = document.getElementsByClassName("parking");
		var balance = document.getElementsByClassName("balance");
		var relics = document.getElementsByClassName("relic");
		for(var i = 0; i < balls.length; i++){
			balls[i].setAttribute("visible", "false");
		}
		for(var i = 0; i < parking.length; i++){
			parking[i].setAttribute("visible", "false");
		}
		for(var i = 0; i < balance.length; i++){
			balance[i].setAttribute("visible", "true");
		}
		for(var i = 0; i < relics.length; i++){
			relics[i].setAttribute("visible", "true");
		}	
	}
	
	function getArrow(dif){
		dif = parseInt(dif);
		if(dif < 0)return '&#9660;';
		if(dif > 0)return '&#9650;';
		return '&emsp;';
	}
	function getCardImage(card){
		if(card == 1)return "/img/yellowcard.png";
		if(card == 2)return "/img/redcard.png";
		if(card == 3)return "/img/yellowredcard.png";
		return "";
	}
	function showResult(data){
	
		var elims = data.name.indexOf("F") >= 0;
		
		#if($overlay)
  			document.getElementById("chroma").setAttribute("visible", "false");
  			document.getElementById("progressBar").setAttribute("visible", "false");
  			document.getElementById("redOverlayWings").setAttribute("visible", "false");
  			document.getElementById("blueOverlayWings").setAttribute("visible", "false");
  		#end
		
		
		document.getElementById("result").setAttribute("elims", elims ? "true" : "false");
		
		document.getElementById("timer").setAttribute("timeout", "false");
		document.getElementById("scoreRed").setAttribute("visible","false");
		document.getElementById("scoreBlue").setAttribute("visible","false");
		document.getElementById("scoreBar").setAttribute("visible","false");
		document.getElementById("timer").setAttribute("visible","false");
		document.getElementById("random").setAttribute("visible","false");
		document.getElementById("preview").setAttribute("visible","false");
		document.getElementById("result").setAttribute("visible","true");
		document.getElementById("selection").setAttribute("visible","false");
	
		document.getElementById("red1_resultNumber").innerHTML = data.red1;
		document.getElementById("red2_resultNumber").innerHTML = data.red2;
		
		document.getElementById("blue1_resultNumber").innerHTML = data.blue1;
		document.getElementById("blue2_resultNumber").innerHTML = data.blue2;
		
		setTop(data.name);
		
		document.getElementById("red1_resultRank").innerHTML = data.red1Rank + getArrow(data.red1Dif);
		document.getElementById("red2_resultRank").innerHTML = data.red2Rank + getArrow(data.red2Dif);
		document.getElementById("blue1_resultRank").innerHTML = data.blue1Rank + getArrow(data.blue1Dif);
		document.getElementById("blue2_resultRank").innerHTML = data.blue2Rank + getArrow(data.blue2Dif);
		
			document.getElementById("red1_resultName").innerHTML = data.red1Name;
			document.getElementById("red2_resultName").innerHTML = data.red2Name;
			document.getElementById("blue1_resultName").innerHTML = data.blue1Name;
			document.getElementById("blue2_resultName").innerHTML = data.blue2Name;
		
		
		
		document.getElementById("red1_card").setAttribute("visible", data.red1Card == 0 ? "false" : "true");
		if(data.red1Card > 0) document.getElementById("red1_card").src= getCardImage(data.red1Card);
		document.getElementById("red2_card").setAttribute("visible", data.red2Card == 0 ? "false" : "true");
		if(data.red2Card > 0) document.getElementById("red2_card").src= getCardImage(data.red2Card);
		document.getElementById("blue1_card").setAttribute("visible", data.blue1Card == 0 ? "false" : "true");
		if(data.blue1Card > 0) document.getElementById("blue1_card").src= getCardImage(data.blue1Card);
		document.getElementById("blue2_card").setAttribute("visible", data.blue2Card == 0 ? "false" : "true");
		if(data.blue2Card > 0) document.getElementById("blue2_card").src= getCardImage(data.blue2Card);
	
		document.getElementById("redField_score").innerHTML = data.redScore;
		document.getElementById("redField_penalty").innerHTML = data.bluePenalty;
		document.getElementById("redField_total").innerHTML = data.redTotal;
		document.getElementById("blueField_score").innerHTML = data.blueScore;
		document.getElementById("blueField_penalty").innerHTML = data.redPenalty;
		document.getElementById("blueField_total").innerHTML = data.blueTotal;
		
		if(elims){
			#if($ad2)
			document.getElementById("redhead_resultNumber").innerHTML = data.red1;
			document.getElementById("red1_resultNumber").innerHTML = data.red2;
			document.getElementById("red2_resultNumber").innerHTML = data.red3;
			document.getElementById("bluehead_resultNumber").innerHTML = data.blue1;
			document.getElementById("blue1_resultNumber").innerHTML = data.blue2;
			document.getElementById("blue2_resultNumber").innerHTML = data.blue3;
			document.getElementById("redhead_resultName").innerHTML = data.red1Name;
			document.getElementById("red1_resultName").innerHTML = data.red2Name;
			document.getElementById("red2_resultName").innerHTML = data.red3Name;
			document.getElementById("bluehead_resultName").innerHTML = data.blue1Name;
			document.getElementById("blue1_resultName").innerHTML = data.blue2Name;
			document.getElementById("blue2_resultName").innerHTML = data.blue3Name;
			document.getElementById("red1Seed").innerHTML = data.redRank;		
			document.getElementById("blue1Seed").innerHTML = data.blueRank;
			document.getElementById("red2Seed").innerHTML = data.redRank;		
			document.getElementById("blue2Seed").innerHTML = data.blueRank;
		
			#else
			document.getElementById("redhead_resultNumber").innerHTML = "&nbsp;"+data.red1+"&nbsp;"+data.red2+"&nbsp;"+data.red3;
			document.getElementById("bluehead_resultNumber").innerHTML = "&nbsp;"+data.blue1+"&nbsp;"+data.blue2+"&nbsp;"+data.blue3;
			
			#end
			document.getElementById("redheadSeed").innerHTML = data.redRank;		
			document.getElementById("blueheadSeed").innerHTML = data.blueRank;
		
			var sr = "Series Tied";
			var im = "bar";
			if(data.redWins >= 2){
				sr = "RED wins series!";
				im = "red";
			} else if(data.blueWins >= 2){
				sr = "BLUE wins series!";
				im = "blue";
			} else if(data.redWins > data.blueWins){
				sr = "RED leads series";
				im = "red";
			} else if(data.blueWins > data.redWins){
				sr = "BLUE leads series";
				im = "blue";
			} 
			document.getElementById("winnerField").innerHTML = sr;
			document.getElementById("winnerImg").src = "/img/alliance"+im+"92.png";
			document.getElementById("winnerField").setAttribute("tie", sr.indexOf("Tied")>=0 ? "true" : "false");
			
			document.getElementById("seriesResult").innerHTML = data.winChar == 'T' ? "Tie!" : (data.winChar == 'R' ? "RED Wins!" : "BLUE Wins!");
			document.getElementById("seriesResultImg").src = "/img/alliance"+(data.winChar == 'T' ? "bar" : (data.winChar == 'R' ? "red" : "blue")) + "92.png";
			document.getElementById("seriesResult").setAttribute("tie", data.winChar == 'T' ? "true" : "false");
			
			document.getElementById("redhead_card").setAttribute("visible", data.red1Card == 0 ? "false" : "true");
			if(data.red1Card > 0) document.getElementById("redhead_card").src=getCardImage(data.red1Card);
			document.getElementById("bluehead_card").setAttribute("visible", data.blue1Card == 0 ? "false" : "true");
			if(data.blue1Card > 0) document.getElementById("bluehead_card").src=getCardImage(data.blue1Card);
		
		} else{
			document.getElementById("redhead_resultNumber").innerHTML = "Team";
			document.getElementById("bluehead_resultNumber").innerHTML = "Team";
			document.getElementById("winnerField").innerHTML = data.winChar == 'T' ? "Tie!" : (data.winChar == 'R' ? "RED Wins!" : "BLUE Wins!");
			document.getElementById("winnerImg").src = "/img/alliance"+(data.winChar == 'T' ? "bar" : (data.winChar == 'R' ? "red" : "blue")) + "92.png";
			document.getElementById("winnerField").setAttribute("tie", data.winChar == 'T' ? "true" : "false");
		}	
	}
	
	function showSelection(data){
		document.getElementById("timer").setAttribute("visible","false");
		document.getElementById("random").setAttribute("visible","false");
		document.getElementById("preview").setAttribute("visible","false");
		document.getElementById("result").setAttribute("visible","false");
		document.getElementById("scoreRed").setAttribute("visible","false");
		document.getElementById("scoreBlue").setAttribute("visible","false");
		document.getElementById("scoreBar").setAttribute("visible","false");
		document.getElementById("selection").setAttribute("visible","true");
		
		#if($overlay)
  			document.getElementById("chroma").setAttribute("visible", "false");
  			document.getElementById("progressBar").setAttribute("visible", "false");
  			document.getElementById("redOverlayWings").setAttribute("visible", "false");
  			document.getElementById("blueOverlayWings").setAttribute("visible", "false");
  		#end
		
		setTop("Alliance Selection");
	
		for(var a = 0; a < 4; a++){
			for(var t = 0; t < 3; t++){
				document.getElementById("selection_"+(a+1)+"_"+(t+1)).innerHTML = data.alliances[a][t] == null ? "" : data.alliances[a][t].number;
			}
		}
		var count = 0;
		var column = 1;
		document.getElementById("available1").innerHTML = "";
		document.getElementById("available2").innerHTML = "";
		document.getElementById("available3").innerHTML = "";
		for (var i = 0; i < data.available.length; i++) {
			var team = data.available[i];
			var rank = team.rank.toString();
			var disp = "<h3>" + '&nbsp;'.repeat(3 - rank.length) + "<font color=\"#700\">" + rank + "</font>" + "&nbsp;" + team.team + '&nbsp;'.repeat(5 - team.numDigits) + "</h4>";
			document.getElementById("available" + column).innerHTML += disp;
			if (++count == 10) {
				column++;
				if (column == 4) {
					break; //if we get to the 37th team just stop
				}
				count = 0;
			}
		}
	}	
	
	
	function showRandom(){
		//get random
		 $.ajax({
                url: "../random/",
                type: "GET",
                dataType: 'json',
                success: function (data) {
                    rand=data.rand;
                    
                    #if($overlay)
			  			document.getElementById("chroma").setAttribute("visible", "false");
			  			document.getElementById("progressBar").setAttribute("visible", "true");
			  			document.getElementById("redOverlayWings").setAttribute("visible", "true");
			  			document.getElementById("blueOverlayWings").setAttribute("visible", "true");
			  		#end
                    
                    document.getElementById("timer").setAttribute("timeout", "false");
                    document.getElementById("timer").setAttribute("visible",#if($ad2)"true"#else"false"#end);
                   	document.getElementById("preview").setAttribute("visible","false");
                   	document.getElementById("scoreRed").setAttribute("visible","true");
					document.getElementById("scoreBlue").setAttribute("visible","true");
					document.getElementById("scoreBar").setAttribute("visible",#if($ad2)"false"#else"true"#end);
					document.getElementById("result").setAttribute("visible","false");
					document.getElementById("selection").setAttribute("visible","false");
                    var r = document.getElementById("random");
                    r.setAttribute("visible", "true");
                    //TODO sizes?
                    r.children[0].src = "/img/random"+rand+"_75.png";
                    initJewels(rand);
                    showKeyColumn(rand);
                },
                error: function () {
                    //ERROR HANDLING
                    console.log("Error");
                    //window.setTimeout(showRandom, 5000);
                }});
	}
	function initJewels(r){
		var src = r < 4 ? "/img/ball-split-flip${jSize}.png": "/img/ball-split${jSize}.png";
		blueJewel1.src = src;
		blueJewel2.src = src;
		redJewel1.src = src;
		redJewel2.src = src;
	} 
	
	function showKeyColumn(r){
		var col = (r-1) % 3;
		for(var index = 1; index <= 2; index++){
			for(var r = 0; r < 4; r++){			
				var cell = document.getElementById("red_"+index+"_"+r+"_"+col);
				cell.setAttribute("visible", "true");
				cell.src = "/img/pink-square${cbSize}.png";				
			} 
		}
		for(var index = 1; index <= 2; index++){
			for(var r = 0; r < 4; r++){			
				var cell = document.getElementById("blue_"+index+"_"+r+"_"+col);
				cell.setAttribute("visible", "true");
				cell.src = "/img/cyan-square${cbSize}.png";				
			} 
		}
		
	}
	
	function showMatch(){
		document.getElementById("timer").setAttribute("timeout", "false");
		document.getElementById("timer").setAttribute("visible","true");
		document.getElementById("random").setAttribute("visible","false");
		document.getElementById("preview").setAttribute("visible","false");
		document.getElementById("scoreRed").setAttribute("visible","true");
		document.getElementById("scoreBlue").setAttribute("visible","true");
		document.getElementById("scoreBar").setAttribute("visible","true");
		document.getElementById("result").setAttribute("visible","false");
		document.getElementById("selection").setAttribute("visible","false");
		
  		document.getElementById("timeoutBar").setAttribute("visible", "false");
  		document.getElementById("timeoutBarImg").setAttribute("visible", "false");
		
		#if($overlay)
  			document.getElementById("chroma").setAttribute("visible", "true");
  			document.getElementById("progressBar").setAttribute("visible", "true");
  			document.getElementById("redOverlayWings").setAttribute("visible", "true");
  			document.getElementById("blueOverlayWings").setAttribute("visible", "true");
  		#end

	}
	
	
	var lastBreakdown = 0;
	function getScoreUpdate(block){
  		var data = {};
  		activeUpdateRequest = $.ajax({
  			url: "../scorebreakdown/",
  			type: "GET",
  			dataType: 'json',
  			data: {
  				block:block,
  				last:lastBreakdown
  			},
  			success: function(data){  			
  				lastBreakdown = data.ts;
  				updateScores(data);
  				if(!stopScores){
  					window.setTimeout(function(){getScoreUpdate(true);}, 1000);
  				}
  			},
  			error: function(xhr, ajaxOptions, thrownError){
  				if(xhr.responseText != "No match loaded" && !stopScores){
  					window.setTimeout(function(){getScoreUpdate(true);}, 1000);
  				}
  			}});
  	}
  	
  	#if($ad2)
  		function getJewelImage(val, flip){
  		//empty
  		if(val == 0) return "/img/ball_black${jSize}.png";
  		//full
  		if(val == 3) return "/img/ball-split" + (flip ? "-flip" : "") + "${jSize}.png";
  		//left missing
  		if(val == 1) return "/img/ball_" + (flip ? "blue" : "red") + "${jSize}.png";
  		//right missing
  		if(val == 2) return "/img/ball_" + (flip ? "red" : "blue") + "${jSize}.png";
  	}
  	#else
  	function getJewelImage(val, flip){
  		//empty
  		if(val == 0) return "/img/ball-split_black${jSize}.png";
  		//full
  		if(val == 3) return "/img/ball-split" + (flip ? "-flip" : "") + "${jSize}.png";
  		//left missing
  		if(val == 1) return "/img/ball-split" + (flip ? "-flip_blue" : "_red") + "${jSize}.png";
  		//right missing
  		if(val == 2) return "/img/ball-split" + (flip ? "-flip_red" : "_blue") + "${jSize}.png";
  	}
  	#end
  	
  	function setCryptobox(alliance, index, val, keys){
  		for(var c = 0; c < 3; c++){
  			var colCount = 0;
			for(var r = 0; r < 4; r++){
				var cell = document.getElementById(alliance+"_"+index+"_"+r+"_"+c);
				var enc = (val >> ((6 * r) + (2*c))) & 3;
				if(enc != 0) colCount++;
				if((keys >> ((6 * r) + (2*c) + (index - 1))) & 1 == 1){
					cell.setAttribute("visible", "true");
					if(enc ==0){
						cell.src = "/img/yellow-empty-square${cbSize}.png"
					} else if(enc == 1){
						cell.src = "/img/yellow-brown-square${cbSize}.png";
					} else {
						cell.src = "/img/yellow-grey-square${cbSize}.png";
					}
					
				} else{
				//todo if want key columnn highlighting to disappear, use endAutoFlag in this and
					cell.setAttribute("visible", (((rand-1) % 3 == c ) ? "true" : enc == 0 ? "false" : "true"));
					if(enc == 0){
						if(endAutoFlag){
							 cell.setAttribute("visible", "false");
						}else{
							 cell.src = alliance=='red' ? "/img/pink-square${cbSize}.png" : "/img/cyan-square${cbSize}.png";
						} 
					} else{
						cell.src = enc == 1 ? "/img/brown-square${cbSize}.png" : "/img/grey-square${cbSize}.png";
					}
				}
			}
			#if($ad2)
			document.getElementById(alliance+"_"+index+"_chevron_c"+c).setAttribute("visible", colCount == 4 ? "true" : "false");
			#end
		} 
		var ciph = ""; 	
		if(val == 6710886 || ((~val) & 0xFFFFFF) == 6710886){
			ciph = "froggy";
		} else if(val == 6908265 || ((~val) & 0xFFFFFF) == 6908265){
			ciph = "snake";
		} else if(val == 10065510 || ((~val) & 0xFFFFFF) == 10065510){
			ciph = "bird";
		}
		var cipher = document.getElementById("gridCipher_"+alliance+"_"+index);
		cipher.setAttribute("visible", ciph == "" ? "false" : "true");
		if(ciph != ""){
			cipher.src = "/img/"+ciph+"-grid-"+alliance+"${cbSize}.png";
		}
  	}
  	
  	function updateScores(obj){
  		var flip = rand < 4;  	
  	
  		blueParking1.src = obj.blue.parkingPoints > 0 ? "/img/parking_blue${pSize}.png" : "/img/parking_black${pSize}.png" ;
  		blueParking2.src = obj.blue.parkingPoints == 20 ? "/img/parking_blue${pSize}.png" : "/img/parking_black${pSize}.png" ;
  		redParking1.src = obj.red.parkingPoints > 0 ? "/img/parking_red${pSize}.png" : "/img/parking_black${pSize}.png" ;
  		redParking2.src = obj.red.parkingPoints == 20 ? "/img/parking_red${pSize}.png" : "/img/parking_black${pSize}.png" ;
  		
  		redBalance1.src = obj.red.balancePoints > 0 ? "/img/tt_red${bSize}.png" : "/img/tt_black${bSize}.png";
  		redBalance2.src = obj.red.balancePoints > 20 ? "/img/tt_red${bSize}.png" : "/img/tt_black${bSize}.png";
  		blueBalance1.src = obj.blue.balancePoints > 0 ? "/img/tt_blue${bSize}.png" : "/img/tt_black${bSize}.png";
  		blueBalance2.src = obj.blue.balancePoints > 20 ? "/img/tt_blue${bSize}.png" : "/img/tt_black${bSize}.png";
  		
  		blueJewel1.src = getJewelImage(obj.blue.jewelSet1, flip);
  		blueJewel2.src = getJewelImage(obj.blue.jewelSet2, flip);
  		redJewel1.src = getJewelImage(obj.red.jewelSet1, flip);
  		redJewel2.src = getJewelImage(obj.red.jewelSet2, flip);
  		
  		setCryptobox('blue', 1, obj.blue.cryptobox1, obj.blue.cbKeys);
  		setCryptobox('blue', 2, obj.blue.cryptobox2, obj.blue.cbKeys);
  		setCryptobox('red', 1, obj.red.cryptobox1, obj.red.cbKeys);
  		setCryptobox('red', 2, obj.red.cryptobox2, obj.red.cbKeys);
  		
  		#if($ad2)
	  		if(obj.red.cbRows !== undefined){
	  			for(var i = 0; i < 8; i++){
	  				document.getElementById("red_"+(Math.floor(i/4)+1)+"_chevron_r"+(i % 4)).setAttribute("visible", ((obj.red.cbRows >> i) & 1 )> 0 ? "true" : "false");
	  			}
	  		
	  		}
	  		if(obj.blue.cbRows !== undefined){
	  			for(var i = 0; i < 8; i++){
	  				document.getElementById("blue_"+(Math.floor(i/4)+1)+"_chevron_r"+(i % 4)).setAttribute("visible", ((obj.blue.cbRows >> i) & 1 )> 0 ? "true" : "false");
	  			}
	  		
	  		}   			
	  		
	  		var relic = document.getElementById("redRelic1");
	  		
	  		if(obj.red.relic1Zone == undefined || obj.red.relic1Zone == 0){
	  			relic.setAttribute("visible", "false");
	  		}else{
	  			relic.setAttribute("visible", "true");
	  			relic.src = "/img/relic_red_"+obj.red.relic1Zone+(obj.red.relic1Standing == "true" ? "":"_side")+".png";
	  		}
	  		 relic = document.getElementById("redRelic2");
	  		if(obj.red.relic2Zone == undefined || obj.red.relic2Zone == 0){
	  			relic.setAttribute("visible", "false");
	  		}else{
	  			relic.setAttribute("visible", "true");
	  			relic.src = "/img/relic_red_"+obj.red.relic2Zone+(obj.red.relic2Standing == "true" ? "":"_side")+".png";
	  		}
	  		 relic = document.getElementById("blueRelic1");
	  		if(obj.blue.relic1Zone == undefined || obj.blue.relic1Zone == 0){
	  			relic.setAttribute("visible", "false");
	  		}else{
	  			relic.setAttribute("visible", "true");
	  			relic.src = "/img/relic_blue_"+obj.blue.relic1Zone+(obj.blue.relic1Standing == "true" ? "":"_side")+".png";
	  		}
	  		 relic = document.getElementById("blueRelic2");
	  		if(obj.blue.relic2Zone == undefined || obj.blue.relic2Zone == 0){
	  			relic.setAttribute("visible", "false");
	  		}else{
	  			relic.setAttribute("visible", "true");
	  			relic.src = "/img/relic_blue_"+obj.blue.relic2Zone+(obj.blue.relic2Standing == "true" ? "":"_side")+".png";
	  		}
	  		
  		#end
  		
  		#if($overlay)
  			var relicScored = false;
  			var relic = document.getElementById("redRelic1");
	  		if(obj.red.relic1Zone == undefined || obj.red.relic1Zone == 0){
	  			relic.src = "/img/relic_black.png";
	  		}else{
	  			relicScored = true;
	  			relic.setAttribute("visible", "true");
	  			relic.src = "/img/relic_red_"+obj.red.relic1Zone+(obj.red.relic1Standing == "true" ? "":"_side")+"_circle.png";
	  		}
	  		 relic = document.getElementById("redRelic2");
	  		if(obj.red.relic2Zone == undefined || obj.red.relic2Zone == 0){
	  			relic.src = "/img/relic_black.png";
	  		}else{
	  			relicScored = true;
	  			relic.setAttribute("visible", "true");
	  			relic.src = "/img/relic_red_"+obj.red.relic2Zone+(obj.red.relic2Standing == "true" ? "":"_side")+"_circle.png";
	  		}
	  		 relic = document.getElementById("blueRelic1");
	  		if(obj.blue.relic1Zone == undefined || obj.blue.relic1Zone == 0){
	  			relic.src = "/img/relic_black.png";
	  		}else{
	  			relicScored = true;
	  			relic.setAttribute("visible", "true");
	  			relic.src = "/img/relic_blue_"+obj.blue.relic1Zone+(obj.blue.relic1Standing == "true" ? "":"_side")+"_circle.png";
	  		}
	  		 relic = document.getElementById("blueRelic2");
	  		if(obj.blue.relic2Zone == undefined || obj.blue.relic2Zone == 0){
	  			relic.src = "/img/relic_black.png";
	  		}else{
	  			relicScored = true;
	  			relic.setAttribute("visible", "true");
	  			relic.src = "/img/relic_blue_"+obj.blue.relic2Zone+(obj.blue.relic2Standing == "true" ? "":"_side")+"_circle.png";
	  		}
	  		
	  		if(relicScored && !endgameFlag){
	  			swapOverlay();
	  		}
  		#end
  		
  		
  		document.getElementById("scoreRed").innerHTML = parseInt(obj.red.teleopPoints) + parseInt(obj.red.autoPoints) + parseInt(obj.red.foulPoints);
  		document.getElementById("scoreBlue").innerHTML = parseInt(obj.blue.teleopPoints) + parseInt(obj.blue.autoPoints) + parseInt(obj.blue.foulPoints);
  	}
  	
  	
  	</script>
  
	</div>	
	</body>
<div id="preload" style="display:none;">
<img src="/img/random1_75.png" width="1" height="1" alt="Image 03" />
<img src="/img/random2_75.png" width="1" height="1" alt="Image 03" />  
<img src="/img/random3_75.png" width="1" height="1" alt="Image 03" />  
<img src="/img/random4_75.png" width="1" height="1" alt="Image 03" />  
<img src="/img/random5_75.png" width="1" height="1" alt="Image 03" />  
<img src="/img/random6_75.png" width="1" height="1" alt="Image 03" />     
   <img src="/digits/Wdigitoff.png" width="1" height="1" alt="Image 01" />
   <img src="/digits/Wcolon.png" width="1" height="1" alt="Image 02" />
   <img src="/digits/Rcolon.png" width="1" height="1" alt="Image 02" />
   <img src="/digits/Ycolon.png" width="1" height="1" alt="Image 02" />
   <img src="/digits/W0.png" width="1" height="1" alt="Image 03" />
   <img src="/digits/W1.png" width="1" height="1" alt="Image 03" />
   <img src="/digits/W2.png" width="1" height="1" alt="Image 03" />
   <img src="/digits/W3.png" width="1" height="1" alt="Image 03" />
   <img src="/digits/W4.png" width="1" height="1" alt="Image 03" />
   <img src="/digits/W5.png" width="1" height="1" alt="Image 03" />
   <img src="/digits/W6.png" width="1" height="1" alt="Image 03" />
   <img src="/digits/W7.png" width="1" height="1" alt="Image 03" />
   <img src="/digits/W8.png" width="1" height="1" alt="Image 03" />
   <img src="/digits/W9.png" width="1" height="1" alt="Image 03" />
   <img src="/digits/Y0.png" width="1" height="1" alt="Image 03" />
   <img src="/digits/Y1.png" width="1" height="1" alt="Image 03" />
   <img src="/digits/Y2.png" width="1" height="1" alt="Image 03" />
   <img src="/digits/Y3.png" width="1" height="1" alt="Image 03" />
   <img src="/digits/Y4.png" width="1" height="1" alt="Image 03" />
   <img src="/digits/Y5.png" width="1" height="1" alt="Image 03" />   
   <img src="/digits/R0.png" width="1" height="1" alt="Image 03" />   
   <img src="/digits/R1.png" width="1" height="1" alt="Image 03" />   
   <img src="/digits/R2.png" width="1" height="1" alt="Image 03" />   
   <img src="/digits/R3.png" width="1" height="1" alt="Image 03" /> 
   <img src="/img/grid-blank_blue50.png" width="1" height="1" alt="Image 03" /> 
   <img src="/img/grid-blank_red50.png" width="1" height="1" alt="Image 03" /> 
   <img src="/img/parking_black20.png" width="1" height="1" alt="Image 03" /> 
   <img src="/img/parking_blue20.png" width="1" height="1" alt="Image 03" /> 
   <img src="/img/parking_red20.png" width="1" height="1" alt="Image 03" /> 
   <img src="/img/tt_black18.png" width="1" height="1" alt="Image 03" /> 
   <img src="/img/tt_blue18.png" width="1" height="1" alt="Image 03" /> 
   <img src="/img/tt_red18.png" width="1" height="1" alt="Image 03" /> 
   <img src="/img/ball-split25.png" width="1" height="1" alt="Image 03" /> 
   <img src="/img/ball-split_red25.png" width="1" height="1" alt="Image 03" />  
   <img src="/img/ball-split_blue25.png" width="1" height="1" alt="Image 03" />  
   <img src="/img/ball-split_black25.png" width="1" height="1" alt="Image 03" />
   <img src="/img/ball-split-flip25.png" width="1" height="1" alt="Image 03" /> 
   <img src="/img/ball-split-flip_red25.png" width="1" height="1" alt="Image 03" />  
   <img src="/img/ball-split-flip_blue25.png" width="1" height="1" alt="Image 03" />    
   <img src="/img/brown-square50.png" width="1" height="1" alt="Image 03" />
   <img src="/img/grey-square50.png" width="1" height="1" alt="Image 03" />    
   <img src="/img/bird-grid-blue50.png" width="1" height="1" alt="Image 03" /> 
   <img src="/img/bird-grid-red50.png" width="1" height="1" alt="Image 03" /> 
   <img src="/img/froggy-grid-blue50.png" width="1" height="1" alt="Image 03" /> 
   <img src="/img/froggy-grid-red50.png" width="1" height="1" alt="Image 03" /> 
   <img src="/img/snake-grid-blue50.png" width="1" height="1" alt="Image 03" /> 
   <img src="/img/snake-grid-red50.png" width="1" height="1" alt="Image 03" />    
   <img src="/img/alliancebar92.png" width="1" height="1" alt="Image 03" />
   <img src="/img/alliancered92.png" width="1" height="1" alt="Image 03" />
   <img src="/img/allianceblue92.png" width="1" height="1" alt="Image 03" />
   <img src="/img/yellowcard.png" width="1" height="1" alt="Image 03" />
   <img src="/img/yellowredcard.png" width="1" height="1" alt="Image 03" />
   <img src="/img/redcard.png" width="1" height="1" alt="Image 03" />
</div>
</html>