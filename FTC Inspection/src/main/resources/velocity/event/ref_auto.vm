#parse("/velocity/layout.vm")
#@mainLayout()
<script>
// Red  - #EE1D23
// Blue - #0166B3
	var red  = '#EE1D23';
	var blue = '#0166B3'; 
	var rand = $rand; //The randomization filled in by velocity. Refresh if re-rand.
	$( document ).ready(function() {
		if (rand < 4) {
			document.getElementById("j_1,1").style.backgroundColor = red;
			document.getElementById("j_1,2").style.backgroundColor = blue;
			document.getElementById("j_2,1").style.backgroundColor = red;
			document.getElementById("j_2,2").style.backgroundColor = blue;	
		} else {
			document.getElementById("j_1,1").style.backgroundColor = blue;
			document.getElementById("j_1,2").style.backgroundColor = red;
			document.getElementById("j_2,1").style.backgroundColor = blue;
			document.getElementById("j_2,2").style.backgroundColor = red;
		}
		var keyloc = '';
		switch (rand % 3) {
		case 0: keyloc = 'Right';
			break;
		case 1: keyloc = 'Left';
			break;
		case 2: keyloc = ''
			break;
		}
		document.getElementById("glyphKeysLabel").textContent = "Glyph Keys (" + keyloc + "):";
	});
	function jewelToggle(set, id){
		var j = document.getElementById("j_"+set+","+id);
		if(j.style.backgroundColor != 'white'){
			j.style.backgroundColor = 'white';
			j.style.borderColor = (id == 1 && rand < 4 || id == 2 && rand > 3) ? red : blue;
		} else{
			//get original color and set it back to that
			j.style.backgroundColor = (id == 1 && rand < 4 || id == 2 && rand > 3) ? red : blue;
			j.style.borderColor = "#000";
		}
		var j1 = document.getElementById("j_"+set+",1");
		var j2 = document.getElementById("j_"+set+",2");
		var val = j1.style.backgroundColor == 'white' ? 0 : 2; //set MSB
		val += j2.style.backgroundColor == 'white' ? 0 : 1; //set LSB
		var obj = {};
		obj["jewelSet"+set] = val;
		scoreUpdate(obj);
	}
	
	function scoreUpdate(obj){
	/*	$.put("../../score/$alliance/",obj).done(function(data){
			//we good
		}).fail(function (xhr, textStatus, errorThrown) {
       		console.log("Error");
    	});*/
    	
    	$.ajax({
                url: "../../score/$alliance/",
                type: "PUT",
                data: obj,
                success: function (data) {
                    //we good
                    console.log("we good");
                },
                error: function () {
                    //ERROR HANDLING
                    console.log("Error");
                }});
	}
	
	function getScoreObject(){
		obj = {};
		obj.autoGlyphs = parseInt(document.getElementById('authoGlyphs').textContent);
		return obj;
	}
	
	function submit(){
		//Send a PUT with all data (do a score update with everything)
		//iff sucessful, reload the page. 
		//For now, must be done after auto ends
		//TODO add jewel state 
		obj = {autoGlyphs:0,cryptoboxKeys:0,parked:0,minor:0,major:1};
		//scoreUpdate(obj);
		location.reload(true);
	}
</script>
<p class="${alliance}Alliance banner">Autonomous</p>
<table>
<tr><td class="left"><label>Glyphs:</label></td><td class="right nowrap absorbing-column">#parse("/velocity/counter_macro.vm")#@labelID()autoGlyphs#end</td></tr>
<tr><td class="left"><label id="glyphKeysLabel">Glyph Keys:</label></td><td class="right nowrap"><div style="width:150%"><label style="width:33%"><input type="radio" name="cryptoboxKeys" onclick="scoreUpdate({cryptoboxKeys:0})" checked />0</label><label style="width:33%"><input type="radio" name="glyph_keys" onclick="scoreUpdate({cryptoboxKeys:1})" />1</label><label style="width:33%"><input type="radio" name="glyph_keys" onclick="scoreUpdate({cryptoboxKeys:2})"/>2</label></div></td></tr>
<tr>
<td class ="left">Jewel Set 1:</td>
<td>
<table cellspacing = 5vw id="jewelset1" frame="box" rules="none"><tr><td>
<div class="circle" id="j_1,1" onclick="jewelToggle(1,1)"></div></td><td><div class="circle" id="j_1,2" onclick="jewelToggle(1,2)"></div></html>
</td></tr></table>
</td>
<tr>
<td class="left">Jewel Set 2:</td>
<td>
<table cellspacing = 5vw id="jewelset2" frame="box" rules="none"><tr><td>
<div class="circle" id="j_2,1" onclick="jewelToggle(2,1)"></div></td><td><div class="circle" id="j_2,2" onclick="jewelToggle(2,2)"></div></html>
</td></tr></table></td>
</tr>
<tr><td class="left"><label>Robots Parked:</label></td><td class="right nowrap"><div style="width:150%"><label style="width:33%"><input type="radio" name="parked" onclick="scoreUpdate({parkedAuto:0})" checked />0</label><label style="width:33%"><input type="radio" name="parked" onclick="scoreUpdate({parkedAuto:1})"  />1</label><label style="width:33%"><input type="radio"name="parked" onclick="scoreUpdate({parkedAuto:2})" />2</label></div></td></tr>
<tr><td class="left"><label>Minor Penalties:</label></td><td class="right nowrap absorbing-column">#parse("/velocity/counter_macro.vm")#@labelID()minor#end</td></tr>
<tr><td class="left"><label>Major Penalties:</label></td><td class="right nowrap absorbing-column">#parse("/velocity/counter_macro.vm")#@labelID()major#end</td></tr>
</table>
<input type="submit" value="Review" onclick="submit()">
#end